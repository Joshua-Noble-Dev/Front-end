<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link rel="stylesheet" type="text/css" href="../../css/jobRolesListStyle.css">
    <link rel="stylesheet" type="text/css" href="../../css/mapInnovation.css">
    <title>Job Roles</title>
    <link rel="icon" type="image/x-icon" href="https://companieslogo.com/img/orig/KNOS.L-8a0d29cc.png?t=1720244492">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.cdnfonts.com/css/galano-grotesque-alt" rel="stylesheet">
    <script src="https://kit.fontawesome.com/2ea65b5d39.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDc-1fAqm7NKlFxoH4lVXdXHSqLgTvh2tw&libraries=places"></script>
    <script src="https://cdn.jsdelivr.net/npm/@googlemaps/markerclustererplus@2.0.0/dist/markerclustererplus.min.js"></script>

</head>
<body>
    {% include "header.html" %}
    <section class="job-roles">
        {% if jobRole %}
        <h2 id="jobRoleName" style="text-align: center;">{{ jobRole.roleName }}</h2>
        <ul>
            <li>
                <h3 id="mapMarker" style="font-family:''Galano Grotesque', sans-serif';">
                    <i class="fa fa-map-marker " aria-hidden="true"></i> {{ jobRole.location }}
                </h3>
                <h4 id="description">Description</h4>
                <p id="description">{{ jobRole.description }}</p>
                <h4 id="responsibilities"> Responsibilities</h4>
                <p id="responsibilities">{{ jobRole.responsibilities }}</p>
                <p id="capability"><b>Capability: </b>{{ jobRole.capabilityName }}</p>
                <p id="ban"><b>Band: </b>{{ jobRole.bandName }}</p>
                <p id="closingDate"><b>Closing Date:</b> {{ jobRole.closingDate | date }}</p>
                <p id="jobSpec"><a title="Sharepoint link to Job Role Spec" href="{{ jobRole.jobSpec }}" target="_blank">Click here to see job specification</a></p>

                <div id="map-container" >
                    <div id="map"></div>
                </div>


                <button class="directions-button" onclick="calculateAndDisplayRoute()">Get Directions</button>


                <div id="directions-panel"></div>
            </li>
        </ul>
        {% else %}
        Job Role does not exist 
        {% endif %}
    </section>
    {% include "footer.html" %}
    
    <script>
        let map;
        let directionsService;
        let directionsRenderer;

        function initMap() {
            // Initialize the map
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,
                center: { lat: 51.5074, lng: -0.1278 } // Default to London if no jobRole.location
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            // If there's a jobRole location, set the center to that location
            const location = '{{ jobRole.location }}';
            if (location) {
                geocodeAddress(location);
            }
        }

        function geocodeAddress(address) {
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status === 'OK') {
                    const position = results[0].geometry.location;
                    map.setCenter(position);
                    new google.maps.Marker({
                        position: position,
                        map: map,
                        title: address
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function calculateAndDisplayRoute() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    const destination = '{{ jobRole.location }}';

                    directionsService.route({
                        origin: userLocation,
                        destination: destination,
                        travelMode: 'DRIVING'
                    }, function(response, status) {
                        if (status === 'OK') {
                            directionsRenderer.setDirections(response);
                            displayDirections(response);
                        } else {
                            alert('Directions request failed due to ' + status);
                        }
                    });
                }, function() {
                    alert("Geolocation is not supported by this browser or permission denied.");
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function displayDirections(response) {
            const directionsPanel = document.getElementById('directions-panel');
            directionsPanel.innerHTML = '';

            const directions = response.routes[0].legs[0].steps;
            if (directions.length > 0) {
                directions.forEach((step, index) => {
                    const stepElement = document.createElement('div');
                    stepElement.innerHTML = `<b>Step ${index + 1}:</b> ${step.instructions}`;
                    directionsPanel.appendChild(stepElement);
                });
            } else {
                directionsPanel.style.display = 'none'; 
            }
        }

        document.addEventListener('DOMContentLoaded', initMap);
    </script>


</body>
</html>
